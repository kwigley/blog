globalThis.openNextDebug = false;globalThis.openNextVersion = "3.2.2";
var g=Object.defineProperty;var m=(e,r)=>()=>(e&&(r=e(e=0)),r);var l=(e,r)=>{for(var t in r)g(e,t,{get:r[t],enumerable:!0})};function i(...e){globalThis.openNextDebug&&console.log(...e)}function N(...e){console.warn(...e)}function u(...e){if(e.some(r=>C(r)))i(...e);else if(e.some(r=>r.__openNextInternal)){let r=e.find(t=>t.__openNextInternal);if(r.logLevel===0){i(...e);return}if(r.logLevel===1){N(...e);return}console.error(...e);return}else console.error(...e)}var b,C,p=m(()=>{b=[{clientName:"S3Client",commandName:"GetObjectCommand",errorName:"NoSuchKey"}],C=e=>b.some(r=>r.clientName===e?.clientName&&r.commandName===e?.commandName&&(r.errorName===e?.error?.name||r.errorName===e?.error?.Code))});var d={};l(d,{default:()=>E});var S,E,v=m(()=>{S={convertFrom(e){let r=e.Records.map(t=>{let{host:o,url:n}=JSON.parse(t.body);return{host:o,url:n,id:t.messageId}});return Promise.resolve({type:"revalidate",records:r})},convertTo(e){return Promise.resolve({type:"revalidate",batchItemFailures:e.records.map(r=>({itemIdentifier:r.id}))})},name:"sqs-revalidate"},E=S});var y={};l(y,{default:()=>D});import{Writable as I}from"node:stream";function P(e){return new Promise(r=>{setTimeout(()=>{r({serverId,type:"warmer"})},e.delay)})}var R,D,w=m(()=>{R=async(e,r)=>async t=>{if("type"in t)return P(t);let o=await r.convertFrom(t),s=await e(o,{writeHeaders:()=>new I({write:(c,f,a)=>{a()}}),onFinish:()=>{}});return r.convertTo(s,t)},D={wrapper:R,name:"aws-lambda",supportStreaming:!1}});import O from"node:fs";import T from"node:https";import F from"node:path";p();async function h(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(v(),d))).default}async function _(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(w(),y))).default}async function x(e){let r=await import("./open-next.config.mjs").then(c=>c.default);globalThis.openNextConfig=r;let t=r[e.type]?.override,o=await h(t?.converter),{name:n,wrapper:s}=await _(t?.wrapper);return i("Using wrapper",n),s(e.handler,o)}p();var W=H(),j=async e=>{let r=[];for(let t of e.records){let{host:o,url:n}=t;i("Revalidating stale page",{host:o,url:n});try{await new Promise((s,c)=>{let f=T.request(`https://${o}${n}`,{method:"HEAD",headers:{"x-prerender-revalidate":W.preview.previewModeId,"x-isr":"1"}},a=>{i("revalidating",{url:n,host:o,headers:a.headers,statusCode:a.statusCode}),(a.statusCode!==200||a.headers["x-nextjs-cache"]!=="REVALIDATED")&&r.push(t),s(a)});f.on("error",a=>{u("Error revalidating page",{host:o,url:n}),c(a)}),f.end()})}catch{r.push(t)}}return r.length>0&&u(`Failed to revalidate ${r.length} pages`,{failedRecords:r}),{type:"revalidate",records:r}},Y=await x({handler:j,type:"revalidate"});function H(){let e=F.join("prerender-manifest.json"),r=O.readFileSync(e,"utf-8");return JSON.parse(r)}export{Y as handler};
